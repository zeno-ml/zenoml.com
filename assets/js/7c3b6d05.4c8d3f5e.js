"use strict";(self.webpackChunkzeno_docs=self.webpackChunkzeno_docs||[]).push([[303],{5195:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>r,contentTitle:()=>s,default:()=>u,frontMatter:()=>i,metadata:()=>l,toc:()=>d});var a=t(5893),o=t(1151);const i={},s="TaxEval",l={id:"examples/taxeval",title:"TaxEval",description:"Open with Zeno",source:"@site/docs/examples/taxeval.mdx",sourceDirName:"examples",slug:"/examples/taxeval",permalink:"/docs/examples/taxeval",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Example Use Cases",permalink:"/docs/examples/"},next:{title:"Audio Transcription",permalink:"/docs/examples/transcription"}},r={},d=[{value:"Dependencies",id:"dependencies",level:2},{value:"Imports",id:"imports",level:2},{value:"Loading the Data",id:"loading-the-data",level:3},{value:"Formatting the Data",id:"formatting-the-data",level:3},{value:"Create a Zeno Project",id:"create-a-zeno-project",level:3},{value:"Uploading Data",id:"uploading-data",level:3},{value:"Uploading System outputs",id:"uploading-system-outputs",level:3}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",img:"img",p:"p",pre:"pre",...(0,o.a)(),...e.components},{Details:t}=n;return t||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.h1,{id:"taxeval",children:"TaxEval"}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.a,{href:"https://hub.zenoml.com/project/e7519c8a-3c07-45ce-90f4-3a5ba4660ab6/LLM%20Taxes%20Benchmark",children:(0,a.jsx)(n.img,{src:"https://img.shields.io/badge/%20-Open_with_Zeno-612593.svg?labelColor=white&logo=data:image/svg%2bxml;base64,PHN2ZyB3aWR0aD0iMzMiIGhlaWdodD0iMzMiIHZpZXdCb3g9IjAgMCAzMyAzMyIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTMyIDE1Ljc4NDJMMTYuNDg2MiAxNS43ODQyTDE2LjQ4NjIgMC4yNzA0MDFMMjQuMzAyIDguMDg2MTdMMzIgMTUuNzg0MloiIGZpbGw9IiM2MTI1OTMiLz4KPHBhdGggZD0iTTE1Ljc5MTcgMTUuODMxMUw4LjAzNDc5IDguMDc0MjJMMTUuNzkxNyAwLjMxNzMyOEwxNS43OTE3IDE1LjgzMTFaIiBmaWxsPSIjNjEyNTkzIiBmaWxsLW9wYWNpdHk9IjAuOCIvPgo8cGF0aCBkPSJNMTQuODY1NSAxNS44MzExTDcuNTk0ODUgMTUuODMxMUw3LjU5NDg1IDguNTYwNDJMMTQuODY1NSAxNS44MzExWiIgZmlsbD0iIzYxMjU5MyIgZmlsbC1vcGFjaXR5PSIwLjYiLz4KPHBhdGggZD0iTTYuMTEyOSAxNS44MzExTDMuMjQxNyAxNS44MzExTDMuMjQxNyAxMi44NjcyTDYuMTEyOSAxNS44MzExWiIgZmlsbD0iIzZBMUI5QSIgZmlsbC1vcGFjaXR5PSIwLjQiLz4KPHBhdGggZD0iTTIuNzMyMjggMTUuODMxTDEuNTE1NSAxNC42MTQzTDIuNzQyNzEgMTMuMzg3TDIuNzMyMjggMTUuODMxWiIgZmlsbD0iIzZBMUI5QSIgZmlsbC1vcGFjaXR5PSIwLjMiLz4KPHBhdGggZD0iTTIuMDM3NiAxNS43ODQyTDEuMTU3NzEgMTUuNzg0MkwxLjE1NzcxIDE0Ljk1MDZMMi4wMzc2IDE1Ljc4NDJaIiBmaWxsPSIjNkExQjlBIiBmaWxsLW9wYWNpdHk9IjAuMiIvPgo8cGF0aCBkPSJNMC44MzM1NjggMTUuNzg0MUwwLjUwOTM5OSAxNS40NkwwLjgzMzU2NyAxNS4xMzU4TDAuODMzNTY4IDE1Ljc4NDFaIiBmaWxsPSIjNjEyNTkzIiBmaWxsLW9wYWNpdHk9IjAuMSIvPgo8cGF0aCBkPSJNMC4xMDYxODcgMTUuNzk0NEwwLjMwMTAyNSAxNS41OTk2TDAuNDk1ODYzIDE1Ljc5NDRIMC4xMDYxODdaIiBmaWxsPSIjNjEyNTkzIiBmaWxsLW9wYWNpdHk9IjAuMSIvPgo8cGF0aCBkPSJNNi45NTIxMyAxNS44MjQ4TDMuNjQwOTkgMTIuNTEzN0w2Ljk2OTYzIDkuMTg1MDNMNi45NTIxMyAxNS44MjQ4WiIgZmlsbD0iIzYxMjU5MyIgZmlsbC1vcGFjaXR5PSIwLjUiLz4KPHBhdGggZD0iTTAuMjk0MjM1IDE2LjQ3OTVMMTUuODA4IDE2LjQ3OTVMMTUuODA4IDMxLjk5MzNMNy45OTIyMyAyNC4xNzc1TDAuMjk0MjM1IDE2LjQ3OTVaIiBmaWxsPSIjNjEyNTkzIi8+CjxwYXRoIGQ9Ik0xNi40OTU2IDE3LjI0MzZMMjMuODUwNyAyNC41ODVMMTYuNDk1NiAzMS45NEwxNi40OTU2IDE3LjI0MzZaIiBmaWxsPSIjNjEyNTkzIiBmaWxsLW9wYWNpdHk9IjAuOCIvPgo8cGF0aCBkPSJNMTYuNTMyNiAxNi40Nzk1TDI0LjQ1MTUgMTYuNDc5NUwyNC40NTE1IDI0LjAyOEwxNi41MzI2IDE2LjQ3OTVaIiBmaWxsPSIjNjEyNTkzIiBmaWxsLW9wYWNpdHk9IjAuNiIvPgo8cGF0aCBkPSJNMjYuMTgxMyAxNi40MzI2TDI5LjA1MjUgMTYuNDMyNkwyOS4wNTI1IDE5LjM5NjRMMjYuMTgxMyAxNi40MzI2WiIgZmlsbD0iIzZBMUI5QSIgZmlsbC1vcGFjaXR5PSIwLjQiLz4KPHBhdGggZD0iTTI5LjU2MTkgMTYuNDMyNkwzMC43Nzg3IDE3LjY0OTRMMjkuNTUxNSAxOC44NzY2TDI5LjU2MTkgMTYuNDMyNloiIGZpbGw9IiM2QTFCOUEiIGZpbGwtb3BhY2l0eT0iMC4zIi8+CjxwYXRoIGQ9Ik0zMC4yNTY2IDE2LjQ3OTVMMzEuMTM2NSAxNi40Nzk1TDMxLjEzNjUgMTcuMzEzMUwzMC4yNTY2IDE2LjQ3OTVaIiBmaWxsPSIjNkExQjlBIiBmaWxsLW9wYWNpdHk9IjAuMiIvPgo8cGF0aCBkPSJNMzEuNDYwNiAxNi40Nzk1TDMxLjc4NDggMTYuODAzN0wzMS40NjA2IDE3LjEyNzlMMzEuNDYwNiAxNi40Nzk1WiIgZmlsbD0iIzYxMjU5MyIgZmlsbC1vcGFjaXR5PSIwLjEiLz4KPHBhdGggZD0iTTMyLjE4OCAxNi40NjkyTDMxLjk5MzIgMTYuNjY0MUwzMS43OTgzIDE2LjQ2OTJIMzIuMTg4WiIgZmlsbD0iIzYxMjU5MyIgZmlsbC1vcGFjaXR5PSIwLjEiLz4KPHBhdGggZD0iTTI1LjM0MjEgMTYuNDM4OUwyOC42NTMyIDE5Ljc1TDI1LjMyNDYgMjMuMDc4NkwyNS4zNDIxIDE2LjQzODlaIiBmaWxsPSIjNjEyNTkzIiBmaWxsLW9wYWNpdHk9IjAuNSIvPgo8L3N2Zz4K",alt:"Open with Zeno"})}),"\n",(0,a.jsx)(n.a,{href:"https://github.com/zeno-ml/zeno-build/blob/main/taxeval/taxes.ipynb",children:(0,a.jsx)(n.img,{src:"https://img.shields.io/badge/%20-Open_Notebook-F37726.svg?labelColor=white&logo=Jupyter",alt:"Open Notebook"})})]}),"\n",(0,a.jsxs)(n.p,{children:["Ever wondered if an LLM can do your taxes?\nIn this example, we'll show you how to investigate the results of the ",(0,a.jsx)(n.a,{href:"https://github.com/danielgross/taxeval",children:"taxeval benchmark"}),".\nWhile we'll go through how to upload the results to Zeno in this example, please refer to the original repository if you want to run the benchmark on your own models."]}),"\n",(0,a.jsx)(n.h2,{id:"dependencies",children:"Dependencies"}),"\n",(0,a.jsx)(n.p,{children:"Let's start by installing the required dependencies for this project:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"pip install pandas zeno-client python-dotenv bertopic\n"})}),"\n",(0,a.jsx)(n.h2,{id:"imports",children:"Imports"}),"\n",(0,a.jsx)(n.p,{children:"After this is all set up, we can now start running our analysis code and uploading data to Zeno.\nWe'll first import relevant libraries which we're going to use:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"import pandas as pd\nimport json\nimport os\nfrom dotenv import load_dotenv\n\nfrom zeno_client import ZenoClient, ZenoMetric\n"})}),"\n",(0,a.jsx)(n.h3,{id:"loading-the-data",children:"Loading the Data"}),"\n",(0,a.jsxs)(n.p,{children:["We'll be uploading already processed model outputs.\nYou can get these ",(0,a.jsx)(n.a,{href:"https://github.com/zeno-ml/zeno-build/blob/main/taxeval/tax-benchmark.json",children:"here"}),", alternatively, you can run your own models following ",(0,a.jsx)(n.a,{href:"https://github.com/danielgross/taxeval",children:"this README"}),"."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'data = json.load(open("tax-benchmark.json"))\n'})}),"\n",(0,a.jsx)(n.h3,{id:"formatting-the-data",children:"Formatting the Data"}),"\n",(0,a.jsx)(n.p,{children:"Before we can upload the data to Zeno, we'll need to convert it to a pandas DataFrame and will format some of the data so that we have all the information we're going to need in our Zeno project."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'def format_question(input):\n    return_question = input["source_question"]["description"].replace("\\\\n", "\\n")\n    return_question += "\\n\\n"\n    for answer in enumerate(input["source_question"]["options"]):\n        return_question += f"{answer[0] + 1}. {answer[1]}\\n"\n    return return_question\n\n\ndf_input = pd.DataFrame(\n    {\n        "question": [format_question(d) for d in data],\n        "answer": [str(d["source_question"]["correct_answer"]) for d in data],\n        "reference": [d["source_question"]["reference"] for d in data],\n        "tag": [d["source_question"]["tag"] for d in data],\n        "category": [d["source_question"]["category"] for d in data],\n    }\n)\ndf_input["question length"] = df_input["question"].apply(lambda x: len(x))\ndf_input["id"] = df_input.index\n'})}),"\n",(0,a.jsxs)(t,{children:[(0,a.jsx)("summary",{children:"Optional: Generate Topics"}),(0,a.jsxs)("div",{children:[(0,a.jsx)(n.p,{children:"If you want you can also add topic information to the data using bertopic as follows:"}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'from bertopic import BERTopic\n\ntopic_model = BERTopic("english", min_topic_size=3)\ntopics, probs = topic_model.fit_transform(\n[d["source_question"]["description"] for d in data]\n)\ndf_input["topic"] = topics\ndf_input["topic"] = df_input["topic"].astype(str)\n'})})]})]}),"\n",(0,a.jsx)(n.h3,{id:"create-a-zeno-project",children:"Create a Zeno Project"}),"\n",(0,a.jsxs)(n.p,{children:["We can now upload our data to a Zeno project.\nYou will need your ",(0,a.jsx)(n.code,{children:"ZENO_API_KEY"})," here, which you can generate by clicking on your profile at the top right to navigate to your ",(0,a.jsx)(n.a,{href:"https://hub.zenoml.com/account",children:"account page"}),"."]}),"\n",(0,a.jsx)(n.p,{children:"Once you have your API key, you can authenticate with the Zeno client and create a project as follows:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'client = zeno_client.ZenoClient(YOUR_API_KEY)\n\nproject = client.create_project(\n    name="LLM Taxes Benchmark",\n    view={\n        "data": {"type": "markdown"},\n        "label": {"type": "text"},\n        "output": {"type": "markdown"},\n    },\n    description="Tax questions for LLMs",\n    public=True,\n    metrics=[\n        ZenoMetric(name="accuracy", type="mean", columns=["correct"]),\n        ZenoMetric(name="output length", type="mean", columns=["output length"]),\n    ],\n)\n'})}),"\n",(0,a.jsx)(n.h3,{id:"uploading-data",children:"Uploading Data"}),"\n",(0,a.jsx)(n.p,{children:"Now that all of this is set up, we can upload the data that we've formatted into a DataFrame before."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'project.upload_dataset(\n    df_input, id_column="id", data_column="question", label_column="answer"\n)\n'})}),"\n",(0,a.jsx)(n.h3,{id:"uploading-system-outputs",children:"Uploading System outputs"}),"\n",(0,a.jsx)(n.p,{children:"Finally, we're going to collect all the model outputs and upload each of the models' results as systems of our Zeno project."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'for model in data[0]["full"].keys():\n    df_system = pd.DataFrame(\n        {\n            "output": [\n                f"**Full:** {d[\'full\'][model]}\\n\\n**Simplified**: {d[\'simplified\'][model]}"\n                for d in data\n            ],\n            "output length": [len(d["full"][model]) for d in data],\n            "simplified output": [str(d["simplified"][model]) for d in data],\n        }\n    )\n    df_system["correct"] = df_input["answer"] == df_system["simplified output"]\n    df_system["id"] = df_input["id"]\n    project.upload_system(\n        df_system, name=model.replace("/", "-"), id_column="id", output_column="output"\n    )\n'})})]})}function u(e={}){const{wrapper:n}={...(0,o.a)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}},1151:(e,n,t)=>{t.d(n,{Z:()=>l,a:()=>s});var a=t(7294);const o={},i=a.createContext(o);function s(e){const n=a.useContext(i);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),a.createElement(i.Provider,{value:n},e.children)}}}]);